```markdown
# Лабораторная работа №3: Многоконтейнерное приложение (Docker Compose)

Проект представляет собой клиент-серверное приложение, оркестрируемое с помощью Docker Compose. Приложение состоит из бэкенда (FastAPI), фронтенда (Nginx), базы данных (PostgreSQL) и веб-интерфейса для управления БД (Adminer).

##  Быстрый старт

Для запуска приложения убедитесь, что у вас установлены **Docker** и **Docker Compose**.

### 1. Настройка окружения
Создайте файл конфигурации из примера:
```bash
cp .env.example .env
```
*При необходимости вы можете отредактировать `.env` файл, чтобы изменить пароли или порты.*

### 2. Запуск
Используйте Makefile для быстрого запуска одной командой:
```bash
# Запуск приложения (сборка + старт в фоне)
make up

# Если make не установлен или не работает:
# docker-compose --env-file .env up -d --build
```

### 3. Доступ к сервисам
После успешного запуска приложение доступно по следующим адресам:

*   **Frontend (Nginx):** [http://localhost](http://localhost)
*   **Backend API Docs (Swagger):** [http://localhost:8000/docs](http://localhost:8000/docs)
*   **DB Admin (Adminer):** [http://localhost:8080](http://localhost:8080)
    *   *System:* PostgreSQL
    *   *Server:* db
    *   *Username:* (из .env, по умолчанию `postgres`)
    *   *Password:* (из .env, по умолчанию `secretpassword`)
    *   *Database:* (из .env, по умолчанию `mydatabase`)

### 4. Остановка
```bash
make down
```

---

##  Архитектура

Приложение построено на микросервисной архитектуре и состоит из 4-х контейнеров, объединенных в изолированную сеть.

### Сервисы

1.  **Backend (`/backend`)**
    *   **Технологии:** Python 3.11, FastAPI, UV.
    *   **Особенности:**
        *   Использует **Multi-stage build** для уменьшения размера образа (< 200MB).
        *   Запускается от **непривилегированного пользователя** `appuser` (security best practice).
        *   Подключается к БД через драйвер `psycopg2` (сборка драйвера происходит на этапе build).

2.  **Frontend (`/frontend`)**
    *   **Технологии:** Nginx (Alpine).
    *   **Роль:** Раздача статики и Reverse Proxy. Перенаправляет запросы `/api/` на бэкенд, скрывая внутреннюю структуру сети от клиента.

3.  **Database (`db`)**
    *   **Технологии:** PostgreSQL 15 (Alpine).
    *   **Persistence:** Данные хранятся в Docker volume `postgres_data`, что гарантирует сохранность данных при перезапуске контейнеров.
    *   **Healthcheck:** Настроен механизм проверки готовности БД (`pg_isready`).

4.  **Adminer (`db-admin`)**
    *   Легковесный интерфейс для управления базой данных. Включается только в профиле `dev`.

### Взаимодействие и сеть

*   Все сервисы находятся в кастомной сети `app-network`.
*   Контейнеры общаются друг с другом по именам сервисов (DNS resolution: `backend`, `db`).
*   **Depends_on:** Бэкенд ожидает полной готовности базы данных (condition: `service_healthy`) перед запуском, что предотвращает ошибки подключения при старте.

---

##  Технические детали реализации

Выполненные требования лабораторной работы:

*   **Docker Compose:** Оркестрация 4-х сервисов.
*   **Изоляция:** Используется сеть `networks: app-network`.
*   **Volumes:** Том `volumes: postgres_data` для персистентности БД.
*   **Оптимизация:**
    *   Бэкенд использует двухэтапную сборку (builder -> final).
    *   Удалены кэши `apt` и `pip` для минимизации веса.
    *   Установлены только runtime-зависимости (`libpq5`) в финальный образ.
*   **Безопасность:**
    *   Использование `.env` для секретов.
    *   Запуск приложения не от root.
*   **Healthchecks:** Бэкенд не стартует, пока PostgreSQL не ответит "OK".

